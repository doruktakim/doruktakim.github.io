---
layout: layouts/base.njk
---
{% set pageLang = lang or "en" %}
{% set otherLang = "tr" %}
{% set shareLabel = "Copy link" %}
{% set shareSuccess = "Link copied to clipboard" %}
{% if pageLang == "tr" %}
  {% set otherLang = "en" %}
  {% set shareLabel = "Baglantiyi kopyala" %}
  {% set shareSuccess = "Baglanti kopyalandi" %}
{% endif %}
{% set translation = collections.post | translationFor(translationKey, otherLang) %}
<article class="post">
  <header>
    <div class="post-meta">
      <p class="post-date">{{ date | dateLocale(pageLang) }}</p>
      {% if translation %}
        <label class="lang-select post-lang-select" for="post-lang">
          <span class="sr-only">Language</span>
          <select id="post-lang" name="lang" onchange="window.location.href=this.value">
            {% if pageLang == "tr" %}
              <option value="{{ translation.url }}">En</option>
              <option value="{{ page.url }}" selected>Tr</option>
            {% else %}
              <option value="{{ page.url }}" selected>En</option>
              <option value="{{ translation.url }}">Tr</option>
            {% endif %}
          </select>
        </label>
      {% endif %}
    </div>
    <h1>{{ title }}</h1>
    <div class="post-summary-row">
      {% if summary %}<p class="post-summary">{{ summary }}</p>{% endif %}
      <button class="share-button" type="button" data-share-button aria-label="{{ shareLabel }}" title="{{ shareLabel }}">
        <svg viewBox="0 0 24 24" role="img" aria-hidden="true" focusable="false">
          <path d="M4 12v7a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7" />
          <path d="M16 6l-4-4-4 4" />
          <path d="M12 2v14" />
        </svg>
      </button>
    </div>
    <span class="share-feedback" role="status" aria-live="polite" aria-atomic="true" data-share-feedback data-share-success="{{ shareSuccess }}"></span>
  </header>
  <div class="post-body">
    {{ content | safe }}
  </div>
</article>
<script>
  (() => {
    const button = document.querySelector("[data-share-button]");
    if (!button) return;

    const feedback = document.querySelector("[data-share-feedback]");
    let timeoutId;

    const setFeedback = (message) => {
      if (!feedback) return;
      feedback.textContent = message;
      if (!message) return;
      clearTimeout(timeoutId);
      timeoutId = window.setTimeout(() => {
        feedback.textContent = "";
      }, 2000);
    };

    const fallbackCopy = (text) => {
      const field = document.createElement("textarea");
      field.value = text;
      field.setAttribute("readonly", "");
      field.style.position = "fixed";
      field.style.top = "-9999px";
      field.style.left = "-9999px";
      document.body.appendChild(field);
      field.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(field);
      return ok;
    };

    const successMessage =
      (feedback && feedback.dataset.shareSuccess) || "Link copied to clipboard";

    button.addEventListener("click", async () => {
      const url = window.location.href;
      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(url);
          setFeedback(successMessage);
          return;
        }
        if (fallbackCopy(url)) {
          setFeedback(successMessage);
        }
      } catch (err) {
        // Ignore clipboard errors silently for speed.
      }
    });
  })();
</script>
