<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% if title %}{{ title }} Â· {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ description or site.description }}" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png" />
    <link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <script>
      (() => {
        try {
          const stored = localStorage.getItem("theme");
          if (stored) {
            document.documentElement.dataset.theme = stored;
            return;
          }
          document.documentElement.dataset.theme = "light";
        } catch (err) {
          // Ignore storage or media errors.
        }
      })();
    </script>
    <style>
      {% include "inline.css" %}
    </style>
  </head>
  <body>
    {% include "partials/nav.njk" %}
    <main class="main">
      {{ content | safe }}
    </main>
    <footer class="footer"></footer>
    <script>
      (() => {
        const toggle = document.querySelector("[data-theme-toggle]");
        if (!toggle) return;

        const root = document.documentElement;
        const stored = (() => {
          try {
            return localStorage.getItem("theme");
          } catch (err) {
            return null;
          }
        })();

        const initialTheme = root.dataset.theme || stored || "light";

        const applyTheme = (theme, persist) => {
          root.dataset.theme = theme;
          if (persist) {
            try {
              localStorage.setItem("theme", theme);
            } catch (err) {
              // Ignore storage errors.
            }
          }
          toggle.setAttribute("aria-pressed", theme === "dark");
          toggle.setAttribute(
            "aria-label",
            theme === "dark" ? "Switch to light mode" : "Switch to dark mode"
          );
        };

        applyTheme(initialTheme, false);

        toggle.addEventListener("click", () => {
          const nextTheme = root.dataset.theme === "dark" ? "light" : "dark";
          applyTheme(nextTheme, true);
        });
      })();
    </script>
    <script>
      (() => {
        const videos = document.querySelectorAll("video[data-lazy]");
        if (!videos.length) return;

        const loadVideo = (video) => {
          if (video.dataset.loaded === "true") return;
          const sources = video.querySelectorAll("source[data-src]");
          sources.forEach((source) => {
            source.src = source.dataset.src;
            source.removeAttribute("data-src");
          });
          video.load();
          video.dataset.loaded = "true";
        };

        videos.forEach((video) => {
          const activate = () => {
            loadVideo(video);
            if (video.paused) {
              video.play().catch(() => {
                // Ignore autoplay prevention.
              });
            }
          };

          video.addEventListener("click", activate, { once: true });
          video.addEventListener("play", () => loadVideo(video), { once: true });
        });
      })();
    </script>
  </body>
</html>
